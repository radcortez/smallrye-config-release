name: SmallRye Release

on:
  release:
    types: [published]

jobs:
  release:
    runs-on: ubuntu-latest
    name: release

    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v1.3.0
        with:
          java-version: 8

      - name: release ${{github.event.release.tag_name}}
        env:
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
        run: |
          git config --global user.name "SmallRye CI"
          git config --global user.email "smallrye@googlegroups.com"
          git switch -c release
          git tag -d ${{github.event.release.tag_name}}
          git push --delete origin ${{github.event.release.tag_name}}
          mvn -B release:prepare -DreleaseVersion=${{github.event.release.tag_name}}

